<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/app/states/play.js - thrust-engine</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="thrust-engine" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Background.html">Background</a></li>
                                <li><a href="../classes/Collisions.html">Collisions</a></li>
                                <li><a href="../classes/FiringStrategy.html">FiringStrategy</a></li>
                                <li><a href="../classes/ForwardsFire.html">ForwardsFire</a></li>
                                <li><a href="../classes/Groups.html">Groups</a></li>
                                <li><a href="../classes/LimpetGun.html">LimpetGun</a></li>
                                <li><a href="../classes/Map.html">Map</a></li>
                                <li><a href="../classes/Orb.html">Orb</a></li>
                                <li><a href="../classes/Player.html">Player</a></li>
                                <li><a href="../classes/states.play.html">states.play</a></li>
                                <li><a href="../classes/states.StatsModule.html">states.StatsModule</a></li>
                                <li><a href="../classes/thrust-engine..html">thrust-engine.</a></li>
                                <li><a href="../classes/TractorBeam.html">TractorBeam</a></li>
                                <li><a href="../classes/Turret.html">Turret</a></li>
                                <li><a href="../classes/UserControl.html">UserControl</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/boot.html">boot</a></li>
                                <li><a href="../modules/load.html">load</a></li>
                                <li><a href="../modules/menu.html">menu</a></li>
                                <li><a href="../modules/properties.html">properties</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src/app/states/play.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
//imports
var properties = require(&#x27;../properties&#x27;);
var Collisions = require(&#x27;../environment/Collisions&#x27;);
var Groups = require(&#x27;../environment/Groups&#x27;);
var Player = require(&#x27;../actors/Player&#x27;);
var LimpetGun = require(&#x27;../actors/LimpetGun&#x27;);
var Orb = require(&#x27;../actors/Orb&#x27;);
var Map = require(&#x27;../actors/Map&#x27;);
var Background = require(&#x27;../actors/Background&#x27;);
var TractorBeam = require(&#x27;../actors/TractorBeam&#x27;);
var features = require(&#x27;../utils/features&#x27;);
var Camera = require(&#x27;camera&#x27;);

//environment
var collisions;
var groups;

//actors
var player;
var orb;
var tractorBeam;
var background;
var limpet1;
var limpet2;

//controls;
var buttonADown = false;
var buttonBDown = false;
var isXDown     = false;



/**
 * The play state - this is where the magic happens
 *
 * @namespace states
 * @class play
 */
module.exports = {

	preload: function() {
    console.warn(&#x27;game.controls.isJoypadEnabled&#x27;, game.controls.isJoypadEnabled);
		if (game.controls.isJoypadEnabled) {
			game.load.atlas(&#x27;dpad&#x27;, &#x27;images/virtualjoystick/skins/dpad.png&#x27;, &#x27;images/virtualjoystick/skins/dpad.json&#x27;);
		}
		game.load.image(&#x27;thrustmap&#x27;, &#x27;images/level_6_x2.png&#x27;);
		game.load.physics(&#x27;physicsData&#x27;, &#x27;images/level_6.json&#x27;);
		game.load.image(&#x27;stars&#x27;, &#x27;images/starfield.png&#x27;);
		game.load.image(&#x27;player&#x27;, &#x27;images/player.png&#x27;);
		game.load.physics(&#x27;playerPhysics&#x27;, &#x27;images/player.json&#x27;);
	},

	create: function() {
		this.defineWorldBounds();
		this.createActors();
		this.createGroupLayering();
		this.initControls();




	},

	update: function() {
		this.beginStats();
		this.checkPlayerInput();
		this.actorsUpdate();
		this.endStats();
	},

	render: function() {
		game.debug.cameraInfo(game.camera, 500, 20);
	},


	checkPlayerInput: function(){
		if (player.isDead) {
			return;
		}

		if ((this.stick &amp;&amp; this.stick.isDown &amp;&amp; this.stick.direction === Phaser.LEFT) || this.cursors.left.isDown) {
			player.body.rotateLeft(100);
		} else if ((this.stick &amp;&amp; this.stick.isDown &amp;&amp; this.stick.direction === Phaser.RIGHT) || this.cursors.right.isDown) {
			player.body.rotateRight(100);
		} else {
			player.body.setZeroRotation();
		}
		if (this.cursors.up.isDown || buttonADown){
			player.body.thrust(400);
		}
		if (!tractorBeam.hasGrabbed) {
			if (isXDown || properties.gamePlay.autoOrbLocking) {
				player.checkOrbDistance();
			}
		} else {
			tractorBeam.drawBeam(player.position);
		}
	},

	actorsUpdate: function() {
		player.update();
		groups.enemies.forEach(function(enemy) {
			enemy.update();
		});
	},

	defineWorldBounds: function() {
    var gameWorld = {width: 3072, height: 4000};
		game.world.setBounds(0,0, gameWorld.width, gameWorld.height);
    this.cameraGroup = new Camera(game);
    //this.cameraGroup.zoomTo(2);
	},

	createActors: function() {
		groups = new Groups(this.cameraGroup);
		collisions = new Collisions();
		if (properties.drawBackground) {
			background = new Background();
		}
		player = new Player(game.world.centerX, 300, collisions, groups);
		orb = new Orb(collisions);
		tractorBeam = new TractorBeam(orb, player);
		player.setTractorBeam(tractorBeam);
		limpet1 = new LimpetGun(428, 1103, 153, collisions, groups);
		limpet2 = new LimpetGun(710, 1053, 206, collisions, groups);
		map = new Map(collisions);

		game.camera.follow(player);

		collisions.set(orb.sprite, [collisions.players, collisions.terrain, collisions.enemyBullets]);
		collisions.set(map, [collisions.players, collisions.terrain, collisions.bullets, collisions.orb]);
	},

	createGroupLayering: function() {
		if (background) {
			groups.terrain.add(background.sprite);
			if (background.mountains) {
				groups.terrain.add(background.mountains);
			}
		}
    groups.terrain.add(map.sprite);
		groups.actors.add(player);
		groups.actors.add(orb.sprite);
		groups.enemies.add(limpet1);
		groups.enemies.add(limpet2);

    groups.swapTerrain();

	},

	initControls: function() {
		if (game.controls.isJoypadEnabled) {
			game.controls.initJoypad();
			this.stick = game.controls.stick;
			game.controls.buttonA.onDown.add(this.pressButtonA, this);
			game.controls.buttonA.onUp.add(this.upButtonA, this);
			game.controls.buttonB.onDown.add(this.pressButtonB, this);
			game.controls.buttonB.onUp.add(this.upButtonB, this);
		}
		this.cursors 	 = game.controls.cursors;
    console.warn(&#x27;this.initControls :: this.cursors&#x27;, this.cursors);
		game.controls.spacePress.onDown.add(player.fire, player);
		game.controls.xKey.onDown.add(this.xDown, this);
		game.controls.xKey.onUp.add(this.xUp, this);
	},

	beginStats: function() {
		if (properties.drawStats) {
			game.stats.start();
		}
	},

	endStats: function() {
		if (properties.drawStats) {
			game.stats.end();
		}
	},

	pressButtonA: function() {
		buttonADown = true;
	},

	upButtonA: function() {
		buttonADown = false;
	},

	pressButtonB: function() {
		buttonBDown = true;
		player.fire();
	},

	upButtonB: function() {
		buttonBDown = false;
	},

	xDown: function () {
		isXDown = true;
		//limpet1.fire();
	},

	xUp: function() {
		isXDown = false;
		if (!properties.gamePlay.autoOrbLocking) {
			tractorBeam.lockingRelease();
		}
	}
};

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
